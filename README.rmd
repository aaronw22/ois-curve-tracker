---
output: github_document
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(data.table)
library(ggplot2)
```

# ASX Implied Cash Rate

This repo automatically scrapes the ASX 30 Day Interbank Cash Rate Futures Implied Yield Curve from [here](https://www.asx.com.au/data/trt/ib_expectation_curve_graph.pdf) and converts it into a simple csv.

## Implied yield curve

```{r graph-main, echo = FALSE, dev = 'svg'}
all_data <- fread("combined-data/all_data.csv", colClasses = c("Date", "numeric", "Date"))

# We can't graph all the days because it is far too messy now
# So grab a weekly sequence of data
past_seq <- seq.Date(max(all_data$scrape_date) - 7*8, max(all_data$scrape_date) - 1, by = "1 week")

ggplot() +
  geom_line(aes(x = date, y = cash_rate, colour = factor(scrape_date)), size = 1, data = all_data[scrape_date %in% past_seq]) +
  geom_line(aes(x = date, y = cash_rate), colour = "black", size = 1.2, data = all_data[scrape_date == max(scrape_date)]) +
  labs(
    title = "Implied Cash Rate over Past 8 Weeks", 
    subtitle = paste0(format(max(all_data$scrape_date), "%d %b %Y"), " in bolded black"),
    x = "Date", y = "Implied cash rate (%)", colour = "Date") +
  scale_x_date(date_labels = "%b %Y", date_breaks = "3 months", date_minor_breaks = "1 month") +
  scale_colour_viridis_d(labels = function(x) format(as.Date(x), "%d %b"), guide = guide_legend(reverse = TRUE)) +
  theme_bw()

```

```{r graph-change, echo = FALSE, dev = 'svg'}
# Graph the change in the implied cash rate between the past 2 days, past week and past 4 weeks

change_data <- all_data[scrape_date %in% c(max(scrape_date), max(scrape_date) - 1, max(scrape_date) - 7, max(scrape_date) - 28)]

change_data <- dcast(change_data, date ~ scrape_date, value.var = "cash_rate")
setnames(change_data, new = c("date", "4 weeks ago", "1 week ago", "1 day ago", "today"))
cols <- c("4 weeks ago", "1 week ago", "1 day ago")
change_data[, (cols) := lapply(.SD, function(x) today - x), .SDcols = cols]
change_data[, today := NULL]
change_data <- melt(change_data, id.vars = "date")
change_data[, variable := ordered(variable, c("1 day ago", "1 week ago", "4 weeks ago"))]

ggplot(change_data, aes(x = date, y = value, fill = variable)) +
  geom_col(position = "dodge") +
  labs(title = "Change in Implied Cash Rate",
       x = "Date", y = "Change in implied cash rate (ppt)") +
  scale_x_date(date_labels = "%b %Y", date_breaks = "3 months", date_minor_breaks = "1 month") +
  theme_bw()

```